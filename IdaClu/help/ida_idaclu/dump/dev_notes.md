# idaclu_shadow

## Glossary

- OI - Object Inspector
- PE - Property Editor

## min_qt_script.py
- w/o PLUGIN_ENTRY function definition at topmost level, 
  Python script is not considered by IDA as a plugin;
  `IDA > undefined function __plugins__ida_clu.PLUGIN_ENTRY`

- `idaapi` exports both symbols `idaapi.plugin_t` and `idaapi.PluginForm`

- When transforming IDAPython-script to IDAPython-plugin
  one should consider moving the following code from script topmost level 
  to `MyPlugin(idaapi.plugin_t).run()`:
```
f = IdaCluForm(PluginForm)
f.Show('IdaClu')
```

- Note that having x5 `idaapi.plugin_t` attributes in subclass is not an option - they are mandatory:
  `IDA > \ida_clu.py: Missing or invalid attribute 'flags'`
  
- w/o the corresponding "loaded" message via `idaapi.msg()` in `IdaCluPlugin(idaapi.plugin_t).init()`
  there is no indication that the plugin loaded successfully
  
- `wanted_hotkey` specified in `IdaCluPlugin(idaapi.plugin_t)` is not just for the info there
  it really gets registered from there and works
  
- In Python script standalone mode `QWidgets.QMessageBox` cannot be invoked right from the start of a script:
```
  if __name__ == "__main__":
    QtWidgets.QMessageBox.information(...)
```
  Otherwise it will produce an error.
   `>QWidget: Must construct a QApplication before a QWidget`
  In IDA environment it is totally OK.
  
- Note that while `PLUGIN_ENTRY()` is plugin entrypoint, topmost Python script code is also executed
  `if __name__ == "__main__":` cap, is what makes script and plugin entrypoints mutually exclusive and run independently
  Topmost level (and so the `if __name__ == "__main__":`) will always be executed before the `PLUGIN_ENTRY()`
  
- There are x2 mutually exclusive EPs
  1. code block inside the condition `if __name__ == "__main__":`
     this ensures that script will be run without any environment
	 code inside `PLUGIN_ENTRY()` will not load - unused function
	 for scripts run with and w/o IDA environment

  2. PLUGIN_ENTRY() -> MyIdaPlugin(idaapi.plugin_t) -> IdaCluForm(idaapi.PluginForm)
     this ensures that script will be run within IDA environment AND(!) from special location that is designated as "plugin folder" - just IDA environment is not enough to run the plugin
	 code inside `if __name__ == "__main__":` will not load - unmet condition ONLY(!) for implicit-load cases, Alt+F7/run script will still trigger this
	 
- The `__name__` in case of implicit plugin loading will be `__plugins__<script_name>`

- Consider the follwoing code:
```
import idaapi
from PyQt5 import QtWidgets

if __name__ == "__main__":
    idaapi.msg("Python script run in IDA script mode")
```

  If `idaapi` is required here, script cannot be run w/o IDA environment.
  In order to be able to be executed independently switch from `idaapi.msg()` to `print()`
  To use both approaches either make a wrapper function with condition choosing between x2 printers `idaapi.msg()` OR `print()`
  or make an import-based condition within `if __name__ == "__main__":` and use `print()` or `idaapi.msg()` as needed
  
- There is no need to make such an extensive check in main script, because anyways except `idaapi` none of these modules will be used in the starter script:
```
inida = True
try:
    # from idaapi import PluginForm
    import idc
    import idaapi
    import idautils
    import ida_bytes
    import ida_ua
    import ida_pro
    from idaapi import PluginForm
except:
    inida = False
    print("not in ida")
```

- Don't forget that Python is scriptable language so execution flow is linear and so the order in which functions/classes appear/are defined matter
```
if __name__ == "__main__":
    sys.exit()

class IdaCluForm(idaapi.PluginForm):
    ...
```
  Otherwise Python(!) will return: `> NameError: name 'idaapi' is not defined`
  The same will happen if `class IdaCluForm(idaapi.PluginForm):` will appear earlier in code than `if __name__ == "__main__":`
  
try:
    import idaapi
except:
    pass
# make silent error in IDA-script: NameError: name 'idaapi' is not defined
# still no luck with standalone execution mode: NameError: name 'idaapi' is not defined

- all imports should happen at top level (at least if the module is used at top level)

- while there is only one possible mode for executing Python script from shell
  there are still x2 possible variants when loaded by IDA - script and plugin
  
- What to choose PLUGIN_KEEP or PLUGIN_OK to return from class IdaCluPlugin(plugin_t).init()

-
class TabWid(QWidget): -- findfuncdialog.ui
class FindFuncTab(QWidget): -- fftabs.ui

- ***Form Implementation*** is a separate topic in ***PyQtX***
- ***Form Implementation*** is a Python script
- ***Form Implementation*** is auto generated
- ***Form Implementation*** is generated by PyQt5 UI-CG (code generator)
- ***Form Implementation*** is generated from reading the corresponding ***.ui file***
- ***Form Implementation*** consists from x1 class and x2 member methods
- ***Form Implementation*** class inherits from ***object***
- ***Form Implementation*** class has ***Ui_*** prefix
- ***Form Implementation*** x2 methods are - `setupUi()`, `retranslateUi()`
- `retranslateUi()` puts all the labels on title bars, menus, buttons, etc.
- `setupUi()` sets up all the controls on the form in their initial state,
  later on, in main plugin script QWidget-derived class that will represent the form ***FI-class*** will be instantiated
  like so: `self.ui = Ui_FindFunc()` and `self.ui.setupUi(self)` will be run
- From now on QWidget-based class member property ***.ui*** is the handler for all the controls
- When creating interfaces in Qt Designer - layoutStretch is a very important property of QObjectX
- Using Qt Designer you can create x1 of x3 - Window(MainWindow,QMainWindow), Widget(Form,QWidget), Dialog,w,w/o Buttons(Dialog,QDialog)
- Dialog template/form is preferred for IDA plugin
- How to change size of QDialog?
- PE/QWidget/geometry/Width,Height
- How to turn QDialog to Horizontal Layout?
- For this at least one widget should be placed on the form. RMB on QDialog object in OI -> Lay out -> Lay Out Horizontally +1/-8
- Why having at least x2 widgets on Dialog layoutStretch property cannot be set?
- How to generate Python code?
- Form->View Python Code... +13/-2